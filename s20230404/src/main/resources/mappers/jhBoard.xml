<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.travelAlone.s20230404.jhBoardMapper">
	
	<!-- 추천 수 증가  -->
    <update id="jhLike" parameterType="Board">
    	UPDATE 	board
    	SET		b_like_cnt = b_like_cnt + 1
    	WHERE	board_id = #{board_id}
    </update>
    
    <!-- 중복 추천시 추천수 감소 -->
    <update id="jhLikeCancel" parameterType="Board">
		UPDATE    board
		SET      b_like_cnt = b_like_cnt - 1
		WHERE   board_id = #{board_id}
    </update>
    
    <!-- 대댓글 sql (1. 댓글사이 가르기) -->
    <update id="updateReLevel" parameterType="Board">
    	UPDATE 	board
    	SET		b_re_step = b_re_step + 1
    	WHERE	b_ref = #{b_ref}
    	AND		b_re_step > #{b_re_step}
    </update>
    
    <!-- 대댓글 sql (1. 가른 댓글 사이에 삽임)  -->
    <insert id="insertReLevel" parameterType="Board">
		INSERT INTO board
        (board_id, member_id, b_content, b_common_board, b_ref, b_re_step, b_re_level, create_date, modified_date)
      	values   (
			board_id_seq.nextval,
			#{member_id},
			#{b_content},
			#{b_common_board},
			#{board_id},
			#{b_re_step} + 1,
			#{b_re_level} + 1,
			sysdate,
			sysdate )
    </insert>
    
    <!-- 게시글 이미지 유무 확인 sql  -->
    <update id="imgStoredFileYn" parameterType="Board">
    	UPDATE 	board
    	SET		img_stored_file_yn = 1
    	WHERE	board_id = #{board_id}
    </update>
    
    <!-- 마이페이지 cnt sql  -->
	<select id="myPageCommunityListCnt" parameterType="Long" resultType="int">
		SELECT	COUNT(*)
		FROM	board
		WHERE	b_re_level = 0
		AND		member_id = #{member_id}            
	</select>
   
	<!-- 마이페이지 리스트 sql  -->
	<select id="myPageCommunityList" parameterType="Board" resultType="Board">
	 	SELECT	 * 
      	FROM 	(SELECT  ROWNUM		rn, a.* 
         		 FROM   (SELECT		b.*, m.m_nickname
                  		 FROM		board b, member m
                  		 WHERE		b.b_re_level = 0 
                  		 AND		b.member_id = #{member_id}
                  		 AND		b.member_id = m.member_id
						 ORDER BY	b.create_date DESC ) a  
				) 
		WHERE rn BETWEEN #{start} AND #{end} 
	</select>
    
    <!-- 유저 페이지 -->
    <select id="userPage" parameterType="long" resultType="Member">
    	SELECT	*
    	FROM	member
    	WHERE	member_id = #{member_id}
    </select>
    
	<!-- 마이페이지 여행지 리뷰 리스트  -->
    <select id="listReviewPageTra" parameterType="Tra_Rev" resultType="Tra_Rev">
	 	SELECT	 * 
      	FROM 	(SELECT  ROWNUM rn, a.* 
         		 FROM   (SELECT		tr.* , t.t_name
						 FROM		tra_rev tr, travel t
						 WHERE		tr.member_id = #{member_id} 
						 AND		tr.travel_id = t.travel_id 
						 ORDER BY	tr.create_date DESC ) a  
				) 
		WHERE	 rn BETWEEN #{start} AND #{end} 
    </select>
    
    <!-- 마이페이지 여행지 리뷰 페이징 -->
    <select id="totalReviewPageTra" parameterType="Long" resultType="int">
		SELECT	COUNT(*)
		FROM	tra_rev
		WHERE	member_id = #{member_id}            
	</select>
	
     <!-- 마이페이지 숙소 리뷰 리스트  -->
    <select id="listReviewPageHou" parameterType="Hou_Rev" resultType="Hou_Rev">
	 	SELECT	 * 
      	FROM 	(SELECT  ROWNUM rn, a.* 
         		 FROM   (SELECT		hr.* , h.h_name
						 FROM		hou_rev hr, house h
						 WHERE		hr.member_id = #{member_id} 
						 AND		hr.house_id = h.house_id  
						 ORDER BY	hr.create_date DESC ) a  
				) 
		WHERE	 rn BETWEEN #{start} AND #{end} 
    </select>
    
    <!-- 마이페이지 숙소 리뷰 페이징 -->
    <select id="totalReviewPageHou" parameterType="Long" resultType="int">
		SELECT	COUNT(*)
		FROM	hou_rev
		WHERE	member_id = #{member_id}            
	</select>
	
    <!-- 마이페이지 맛집 리뷰 리스트  -->
    <select id="listReviewPageRes" parameterType="Res_Rev" resultType="Res_Rev">
	 	SELECT	 * 
      	FROM 	(SELECT  ROWNUM rn, a.* 
         		 FROM   (SELECT		rr.* , r.r_name
						 FROM		res_rev rr, restaurant r
						 WHERE		rr.member_id = #{member_id} 
						 AND		rr.restaurant_id = r.restaurant_id  
						 ORDER BY	rr.create_date DESC ) a  
				) 
		WHERE	 rn BETWEEN #{start} AND #{end} 
    </select>
    
    <!-- 마이페이지 맛집 리뷰 페이징 -->
    <select id="totalReviewPageRes" parameterType="Long" resultType="int">
		SELECT	COUNT(*)
		FROM	res_rev
		WHERE	member_id = #{member_id}            
	</select>
	
	
	
	
</mapper>